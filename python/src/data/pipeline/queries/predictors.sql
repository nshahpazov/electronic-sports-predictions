-- SELECT DISTINCT attack_type from hero_characteristics;
-- SELECT roles like "%Carry%" as has_carry from hero_characteristics;
SELECT mp.match_id,

-- response variable
m.radiant_win,

-- has roles indicators in team 1
sum(hc.roles like "%Carry%" and player_slot < 128) as has_carry_1,
sum(hc.roles like "%Escape%" and player_slot < 128) as has_escape_1,
sum(hc.roles like "%Nuker%" and player_slot < 128) as has_nuker_1,
sum(hc.roles like "%Initiator%" and player_slot < 128) as has_initiator_1,
sum(hc.roles like "%Durable%" and player_slot < 128) as has_durable_1,
sum(hc.roles like "%Disabler%" and player_slot < 128) as has_disabler_1,
sum(hc.roles like "%Jungler%" and player_slot < 128) as has_jungler_1,
sum(hc.roles like "%Support%" and player_slot < 128) as has_support_1,
sum(hc.roles like "%Pusher%" and player_slot < 128) as has_pusher_1,
sum(hc.roles like "%Jungler%" and player_slot < 128) as has_jungler_1,

-- has roles indicators in team 2
sum(hc.roles like "%Carry%" and player_slot >= 128) as has_carry_2,
sum(hc.roles like "%Escape%" and player_slot >= 128) as has_escape_2,
sum(hc.roles like "%Nuker%" and player_slot >= 128) as has_nuker_2,
sum(hc.roles like "%Initiator%" and player_slot >= 128) as has_initiator_2,
sum(hc.roles like "%Durable%" and player_slot >= 128) as has_durable_2,
sum(hc.roles like "%Disabler%" and player_slot >= 128) as has_disabler_2,
sum(hc.roles like "%Jungler%" and player_slot >= 128) as has_jungler_2,
sum(hc.roles like "%Support%" and player_slot >= 128) as has_support_2,
sum(hc.roles like "%Pusher%" and player_slot >= 128) as has_pusher_2,
sum(hc.roles like "%Jungler%" and player_slot >= 128) as has_jungler_2,

-- number primary attributes in each the radiant team
sum(hc.primary_attr like "%agi%" and player_slot < 128) as has_primary_agi_1,
sum(hc.primary_attr like "%int%" and player_slot < 128) as has_primary_int_1,
sum(hc.primary_attr like "%str%" and player_slot < 128) as has_primary_str_1,

-- number primary attributes in each the dire team
sum(hc.primary_attr like "%agi%" and player_slot >= 128) as has_primary_agi_2,
sum(hc.primary_attr like "%int%" and player_slot >= 128) as has_primary_int_2,
sum(hc.primary_attr like "%str%" and player_slot >= 128) as has_primary_str_2,


-- number of attack types being Melee or Ranged in team 1 (Radiant)
sum(hc.attack_type like "%Melee%" and player_slot < 128) as has_melee_1,
sum(hc.attack_type like "%Ranged%" and player_slot < 128) as has_ranged_1,

-- number of attack types being Melee or Ranged in team 2 (Dire)
sum(hc.attack_type like "%Melee%" and player_slot >= 128) as has_melee_2,
sum(hc.attack_type like "%Ranged%" and player_slot >= 128) as has_ranged_2,

-- average difference between the two teams of hero numeric characteristics
coalesce(AVG(CASE WHEN player_slot < 128 THEN base_armor ELSE -base_armor END), 0) as "base_armor_diff",
coalesce(AVG(CASE WHEN player_slot < 128 THEN base_attack_min ELSE -base_attack_min END), 0) as "base_attack_min_diff",
coalesce(AVG(CASE WHEN player_slot < 128 THEN hc.base_attack_max ELSE -hc.base_attack_max END), 0) as "base_attack_max_diff",
coalesce(AVG(CASE WHEN player_slot < 128 THEN hc.base_str ELSE -hc.base_str END), 0) as "base_str_diff",
coalesce(AVG(CASE WHEN player_slot < 128 THEN hc.base_agi ELSE -hc.base_agi END), 0) as "base_agi_diff",
coalesce(AVG(CASE WHEN player_slot < 128 THEN hc.base_int ELSE -hc.base_int END), 0) as "base_int_diff",
coalesce(AVG(CASE WHEN player_slot < 128 THEN hc.str_gain ELSE -hc.str_gain END), 0) as "str_gain_diff",
coalesce(AVG(CASE WHEN player_slot < 128 THEN hc.agi_gain ELSE -hc.agi_gain END), 0) as "agi_gain_diff",
coalesce(AVG(CASE WHEN player_slot < 128 THEN hc.int_gain ELSE -hc.int_gain END), 0) as "int_gain_diff",
coalesce(AVG(CASE WHEN player_slot < 128 THEN hc.attack_range ELSE -hc.attack_range END), 0) as "attack_range_diff",
coalesce(AVG(CASE WHEN player_slot < 128 THEN hc.projectile_speed ELSE -hc.projectile_speed END), 0) as "projectile_speed_diff",
coalesce(AVG(CASE WHEN player_slot < 128 THEN hc.attack_rate ELSE -hc.attack_rate END), 0) as "attack_rate_diff",
coalesce(AVG(CASE WHEN player_slot < 128 THEN hc.move_speed ELSE -hc.move_speed END), 0) as "move_speed_diff",
coalesce(AVG(CASE WHEN player_slot < 128 THEN hc.turn_rate ELSE -hc.turn_rate END), 0) as "turn_rate_diff",

-- hero_{j} = I(hero_j belongs to radiant team)
sum(mp.hero_id =   1 and mp.player_slot < 128) as "hero_1",
sum(mp.hero_id =   2 and mp.player_slot < 128) as "hero_2",
sum(mp.hero_id =   3 and mp.player_slot < 128) as "hero_3",
sum(mp.hero_id =   4 and mp.player_slot < 128) as "hero_4",
sum(mp.hero_id =   5 and mp.player_slot < 128) as "hero_5",
sum(mp.hero_id =   6 and mp.player_slot < 128) as "hero_6",
sum(mp.hero_id =   7 and mp.player_slot < 128) as "hero_7",
sum(mp.hero_id =   8 and mp.player_slot < 128) as "hero_8",
sum(mp.hero_id =   9 and mp.player_slot < 128) as "hero_9",
sum(mp.hero_id =  10 and mp.player_slot < 128) as "hero_10",
sum(mp.hero_id =  11 and mp.player_slot < 128) as "hero_11",
sum(mp.hero_id =  12 and mp.player_slot < 128) as "hero_12",
sum(mp.hero_id =  13 and mp.player_slot < 128) as "hero_13",
sum(mp.hero_id =  14 and mp.player_slot < 128) as "hero_14",
sum(mp.hero_id =  15 and mp.player_slot < 128) as "hero_15",
sum(mp.hero_id =  16 and mp.player_slot < 128) as "hero_16",
sum(mp.hero_id =  17 and mp.player_slot < 128) as "hero_17",
sum(mp.hero_id =  18 and mp.player_slot < 128) as "hero_18",
sum(mp.hero_id =  19 and mp.player_slot < 128) as "hero_19",
sum(mp.hero_id =  20 and mp.player_slot < 128) as "hero_20",
sum(mp.hero_id =  21 and mp.player_slot < 128) as "hero_21",
sum(mp.hero_id =  22 and mp.player_slot < 128) as "hero_22",
sum(mp.hero_id =  23 and mp.player_slot < 128) as "hero_23",
sum(mp.hero_id =  24 and mp.player_slot < 128) as "hero_24",
sum(mp.hero_id =  25 and mp.player_slot < 128) as "hero_25",
sum(mp.hero_id =  26 and mp.player_slot < 128) as "hero_26",
sum(mp.hero_id =  27 and mp.player_slot < 128) as "hero_27",
sum(mp.hero_id =  28 and mp.player_slot < 128) as "hero_28",
sum(mp.hero_id =  29 and mp.player_slot < 128) as "hero_29",
sum(mp.hero_id =  30 and mp.player_slot < 128) as "hero_30",
sum(mp.hero_id =  31 and mp.player_slot < 128) as "hero_31",
sum(mp.hero_id =  32 and mp.player_slot < 128) as "hero_32",
sum(mp.hero_id =  33 and mp.player_slot < 128) as "hero_33",
sum(mp.hero_id =  34 and mp.player_slot < 128) as "hero_34",
sum(mp.hero_id =  35 and mp.player_slot < 128) as "hero_35",
sum(mp.hero_id =  36 and mp.player_slot < 128) as "hero_36",
sum(mp.hero_id =  37 and mp.player_slot < 128) as "hero_37",
sum(mp.hero_id =  38 and mp.player_slot < 128) as "hero_38",
sum(mp.hero_id =  39 and mp.player_slot < 128) as "hero_39",
sum(mp.hero_id =  40 and mp.player_slot < 128) as "hero_40",
sum(mp.hero_id =  41 and mp.player_slot < 128) as "hero_41",
sum(mp.hero_id =  42 and mp.player_slot < 128) as "hero_42",
sum(mp.hero_id =  43 and mp.player_slot < 128) as "hero_43",
sum(mp.hero_id =  44 and mp.player_slot < 128) as "hero_44",
sum(mp.hero_id =  45 and mp.player_slot < 128) as "hero_45",
sum(mp.hero_id =  46 and mp.player_slot < 128) as "hero_46",
sum(mp.hero_id =  47 and mp.player_slot < 128) as "hero_47",
sum(mp.hero_id =  48 and mp.player_slot < 128) as "hero_48",
sum(mp.hero_id =  49 and mp.player_slot < 128) as "hero_49",
sum(mp.hero_id =  50 and mp.player_slot < 128) as "hero_50",
sum(mp.hero_id =  51 and mp.player_slot < 128) as "hero_51",
sum(mp.hero_id =  52 and mp.player_slot < 128) as "hero_52",
sum(mp.hero_id =  53 and mp.player_slot < 128) as "hero_53",
sum(mp.hero_id =  54 and mp.player_slot < 128) as "hero_54",
sum(mp.hero_id =  55 and mp.player_slot < 128) as "hero_55",
sum(mp.hero_id =  56 and mp.player_slot < 128) as "hero_56",
sum(mp.hero_id =  57 and mp.player_slot < 128) as "hero_57",
sum(mp.hero_id =  58 and mp.player_slot < 128) as "hero_58",
sum(mp.hero_id =  59 and mp.player_slot < 128) as "hero_59",
sum(mp.hero_id =  60 and mp.player_slot < 128) as "hero_60",
sum(mp.hero_id =  61 and mp.player_slot < 128) as "hero_61",
sum(mp.hero_id =  62 and mp.player_slot < 128) as "hero_62",
sum(mp.hero_id =  63 and mp.player_slot < 128) as "hero_63",
sum(mp.hero_id =  64 and mp.player_slot < 128) as "hero_64",
sum(mp.hero_id =  65 and mp.player_slot < 128) as "hero_65",
sum(mp.hero_id =  66 and mp.player_slot < 128) as "hero_66",
sum(mp.hero_id =  67 and mp.player_slot < 128) as "hero_67",
sum(mp.hero_id =  68 and mp.player_slot < 128) as "hero_68",
sum(mp.hero_id =  69 and mp.player_slot < 128) as "hero_69",
sum(mp.hero_id =  70 and mp.player_slot < 128) as "hero_70",
sum(mp.hero_id =  71 and mp.player_slot < 128) as "hero_71",
sum(mp.hero_id =  72 and mp.player_slot < 128) as "hero_72",
sum(mp.hero_id =  73 and mp.player_slot < 128) as "hero_73",
sum(mp.hero_id =  74 and mp.player_slot < 128) as "hero_74",
sum(mp.hero_id =  75 and mp.player_slot < 128) as "hero_75",
sum(mp.hero_id =  76 and mp.player_slot < 128) as "hero_76",
sum(mp.hero_id =  77 and mp.player_slot < 128) as "hero_77",
sum(mp.hero_id =  78 and mp.player_slot < 128) as "hero_78",
sum(mp.hero_id =  79 and mp.player_slot < 128) as "hero_79",
sum(mp.hero_id =  80 and mp.player_slot < 128) as "hero_80",
sum(mp.hero_id =  81 and mp.player_slot < 128) as "hero_81",
sum(mp.hero_id =  82 and mp.player_slot < 128) as "hero_82",
sum(mp.hero_id =  83 and mp.player_slot < 128) as "hero_83",
sum(mp.hero_id =  84 and mp.player_slot < 128) as "hero_84",
sum(mp.hero_id =  85 and mp.player_slot < 128) as "hero_85",
sum(mp.hero_id =  86 and mp.player_slot < 128) as "hero_86",
sum(mp.hero_id =  87 and mp.player_slot < 128) as "hero_87",
sum(mp.hero_id =  88 and mp.player_slot < 128) as "hero_88",
sum(mp.hero_id =  89 and mp.player_slot < 128) as "hero_89",
sum(mp.hero_id =  90 and mp.player_slot < 128) as "hero_90",
sum(mp.hero_id =  91 and mp.player_slot < 128) as "hero_91",
sum(mp.hero_id =  92 and mp.player_slot < 128) as "hero_92",
sum(mp.hero_id =  93 and mp.player_slot < 128) as "hero_93",
sum(mp.hero_id =  94 and mp.player_slot < 128) as "hero_94",
sum(mp.hero_id =  95 and mp.player_slot < 128) as "hero_95",
sum(mp.hero_id =  96 and mp.player_slot < 128) as "hero_96",
sum(mp.hero_id =  97 and mp.player_slot < 128) as "hero_97",
sum(mp.hero_id =  98 and mp.player_slot < 128) as "hero_98",
sum(mp.hero_id =  99 and mp.player_slot < 128) as "hero_99",
sum(mp.hero_id = 100 and mp.player_slot < 128) as "hero_100",
sum(mp.hero_id = 101 and mp.player_slot < 128) as "hero_101",
sum(mp.hero_id = 102 and mp.player_slot < 128) as "hero_102",
sum(mp.hero_id = 103 and mp.player_slot < 128) as "hero_103",
sum(mp.hero_id = 104 and mp.player_slot < 128) as "hero_104",
sum(mp.hero_id = 105 and mp.player_slot < 128) as "hero_105",
sum(mp.hero_id = 106 and mp.player_slot < 128) as "hero_106",
sum(mp.hero_id = 107 and mp.player_slot < 128) as "hero_107",
sum(mp.hero_id = 108 and mp.player_slot < 128) as "hero_108",
sum(mp.hero_id = 109 and mp.player_slot < 128) as "hero_109",
sum(mp.hero_id = 110 and mp.player_slot < 128) as "hero_110",
sum(mp.hero_id = 111 and mp.player_slot < 128) as "hero_111",
sum(mp.hero_id = 112 and mp.player_slot < 128) as "hero_112",

-- hero_{j+112} = I(hero_j belongs to dire team)
sum(mp.hero_id =   1 and mp.player_slot >= 128) as  "hero_113",
sum(mp.hero_id =   2 and mp.player_slot >= 128) as  "hero_114",
sum(mp.hero_id =   3 and mp.player_slot >= 128) as  "hero_115",
sum(mp.hero_id =   4 and mp.player_slot >= 128) as  "hero_116",
sum(mp.hero_id =   5 and mp.player_slot >= 128) as  "hero_117",
sum(mp.hero_id =   6 and mp.player_slot >= 128) as  "hero_118",
sum(mp.hero_id =   7 and mp.player_slot >= 128) as  "hero_119",
sum(mp.hero_id =   8 and mp.player_slot >= 128) as  "hero_120",
sum(mp.hero_id =   9 and mp.player_slot >= 128) as  "hero_121",
sum(mp.hero_id =  10 and mp.player_slot >= 128) as  "hero_122",
sum(mp.hero_id =  11 and mp.player_slot >= 128) as  "hero_123",
sum(mp.hero_id =  12 and mp.player_slot >= 128) as  "hero_124",
sum(mp.hero_id =  13 and mp.player_slot >= 128) as  "hero_125",
sum(mp.hero_id =  14 and mp.player_slot >= 128) as  "hero_126",
sum(mp.hero_id =  15 and mp.player_slot >= 128) as  "hero_127",
sum(mp.hero_id =  16 and mp.player_slot >= 128) as  "hero_128",
sum(mp.hero_id =  17 and mp.player_slot >= 128) as  "hero_129",
sum(mp.hero_id =  18 and mp.player_slot >= 128) as  "hero_130",
sum(mp.hero_id =  19 and mp.player_slot >= 128) as  "hero_131",
sum(mp.hero_id =  20 and mp.player_slot >= 128) as  "hero_132",
sum(mp.hero_id =  21 and mp.player_slot >= 128) as  "hero_133",
sum(mp.hero_id =  22 and mp.player_slot >= 128) as  "hero_134",
sum(mp.hero_id =  23 and mp.player_slot >= 128) as  "hero_135",
sum(mp.hero_id =  24 and mp.player_slot >= 128) as  "hero_136",
sum(mp.hero_id =  25 and mp.player_slot >= 128) as  "hero_137",
sum(mp.hero_id =  26 and mp.player_slot >= 128) as  "hero_138",
sum(mp.hero_id =  27 and mp.player_slot >= 128) as  "hero_139",
sum(mp.hero_id =  28 and mp.player_slot >= 128) as  "hero_140",
sum(mp.hero_id =  29 and mp.player_slot >= 128) as  "hero_141",
sum(mp.hero_id =  30 and mp.player_slot >= 128) as  "hero_142",
sum(mp.hero_id =  31 and mp.player_slot >= 128) as  "hero_143",
sum(mp.hero_id =  32 and mp.player_slot >= 128) as  "hero_144",
sum(mp.hero_id =  33 and mp.player_slot >= 128) as  "hero_145",
sum(mp.hero_id =  34 and mp.player_slot >= 128) as  "hero_146",
sum(mp.hero_id =  35 and mp.player_slot >= 128) as  "hero_147",
sum(mp.hero_id =  36 and mp.player_slot >= 128) as  "hero_148",
sum(mp.hero_id =  37 and mp.player_slot >= 128) as  "hero_149",
sum(mp.hero_id =  38 and mp.player_slot >= 128) as  "hero_150",
sum(mp.hero_id =  39 and mp.player_slot >= 128) as  "hero_151",
sum(mp.hero_id =  40 and mp.player_slot >= 128) as  "hero_152",
sum(mp.hero_id =  41 and mp.player_slot >= 128) as  "hero_153",
sum(mp.hero_id =  42 and mp.player_slot >= 128) as  "hero_154",
sum(mp.hero_id =  43 and mp.player_slot >= 128) as  "hero_155",
sum(mp.hero_id =  44 and mp.player_slot >= 128) as  "hero_156",
sum(mp.hero_id =  45 and mp.player_slot >= 128) as  "hero_157",
sum(mp.hero_id =  46 and mp.player_slot >= 128) as  "hero_158",
sum(mp.hero_id =  47 and mp.player_slot >= 128) as  "hero_159",
sum(mp.hero_id =  48 and mp.player_slot >= 128) as  "hero_160",
sum(mp.hero_id =  49 and mp.player_slot >= 128) as  "hero_161",
sum(mp.hero_id =  50 and mp.player_slot >= 128) as  "hero_162",
sum(mp.hero_id =  51 and mp.player_slot >= 128) as  "hero_163",
sum(mp.hero_id =  52 and mp.player_slot >= 128) as  "hero_164",
sum(mp.hero_id =  53 and mp.player_slot >= 128) as  "hero_165",
sum(mp.hero_id =  54 and mp.player_slot >= 128) as  "hero_166",
sum(mp.hero_id =  55 and mp.player_slot >= 128) as  "hero_167",
sum(mp.hero_id =  56 and mp.player_slot >= 128) as  "hero_168",
sum(mp.hero_id =  57 and mp.player_slot >= 128) as  "hero_169",
sum(mp.hero_id =  58 and mp.player_slot >= 128) as  "hero_170",
sum(mp.hero_id =  59 and mp.player_slot >= 128) as  "hero_171",
sum(mp.hero_id =  60 and mp.player_slot >= 128) as  "hero_172",
sum(mp.hero_id =  61 and mp.player_slot >= 128) as  "hero_173",
sum(mp.hero_id =  62 and mp.player_slot >= 128) as  "hero_174",
sum(mp.hero_id =  63 and mp.player_slot >= 128) as  "hero_175",
sum(mp.hero_id =  64 and mp.player_slot >= 128) as  "hero_176",
sum(mp.hero_id =  65 and mp.player_slot >= 128) as  "hero_177",
sum(mp.hero_id =  66 and mp.player_slot >= 128) as  "hero_178",
sum(mp.hero_id =  67 and mp.player_slot >= 128) as  "hero_179",
sum(mp.hero_id =  68 and mp.player_slot >= 128) as  "hero_180",
sum(mp.hero_id =  69 and mp.player_slot >= 128) as  "hero_181",
sum(mp.hero_id =  70 and mp.player_slot >= 128) as  "hero_182",
sum(mp.hero_id =  71 and mp.player_slot >= 128) as  "hero_183",
sum(mp.hero_id =  72 and mp.player_slot >= 128) as  "hero_184",
sum(mp.hero_id =  73 and mp.player_slot >= 128) as  "hero_185",
sum(mp.hero_id =  74 and mp.player_slot >= 128) as  "hero_186",
sum(mp.hero_id =  75 and mp.player_slot >= 128) as  "hero_187",
sum(mp.hero_id =  76 and mp.player_slot >= 128) as  "hero_188",
sum(mp.hero_id =  77 and mp.player_slot >= 128) as  "hero_189",
sum(mp.hero_id =  78 and mp.player_slot >= 128) as  "hero_190",
sum(mp.hero_id =  79 and mp.player_slot >= 128) as  "hero_191",
sum(mp.hero_id =  80 and mp.player_slot >= 128) as  "hero_192",
sum(mp.hero_id =  81 and mp.player_slot >= 128) as  "hero_193",
sum(mp.hero_id =  82 and mp.player_slot >= 128) as  "hero_194",
sum(mp.hero_id =  83 and mp.player_slot >= 128) as  "hero_195",
sum(mp.hero_id =  84 and mp.player_slot >= 128) as  "hero_196",
sum(mp.hero_id =  85 and mp.player_slot >= 128) as  "hero_197",
sum(mp.hero_id =  86 and mp.player_slot >= 128) as  "hero_198",
sum(mp.hero_id =  87 and mp.player_slot >= 128) as  "hero_199",
sum(mp.hero_id =  88 and mp.player_slot >= 128) as  "hero_200",
sum(mp.hero_id =  89 and mp.player_slot >= 128) as  "hero_201",
sum(mp.hero_id =  90 and mp.player_slot >= 128) as  "hero_202",
sum(mp.hero_id =  91 and mp.player_slot >= 128) as  "hero_203",
sum(mp.hero_id =  92 and mp.player_slot >= 128) as  "hero_204",
sum(mp.hero_id =  93 and mp.player_slot >= 128) as  "hero_205",
sum(mp.hero_id =  94 and mp.player_slot >= 128) as  "hero_206",
sum(mp.hero_id =  95 and mp.player_slot >= 128) as  "hero_207",
sum(mp.hero_id =  96 and mp.player_slot >= 128) as  "hero_208",
sum(mp.hero_id =  97 and mp.player_slot >= 128) as  "hero_209",
sum(mp.hero_id =  98 and mp.player_slot >= 128) as  "hero_210",
sum(mp.hero_id =  99 and mp.player_slot >= 128) as  "hero_211",
sum(mp.hero_id = 100 and mp.player_slot >= 128) as "hero_212",
sum(mp.hero_id = 101 and mp.player_slot >= 128) as "hero_213",
sum(mp.hero_id = 102 and mp.player_slot >= 128) as "hero_214",
sum(mp.hero_id = 103 and mp.player_slot >= 128) as "hero_215",
sum(mp.hero_id = 104 and mp.player_slot >= 128) as "hero_216",
sum(mp.hero_id = 105 and mp.player_slot >= 128) as "hero_217",
sum(mp.hero_id = 106 and mp.player_slot >= 128) as "hero_218",
sum(mp.hero_id = 107 and mp.player_slot >= 128) as "hero_219",
sum(mp.hero_id = 108 and mp.player_slot >= 128) as "hero_220",
sum(mp.hero_id = 109 and mp.player_slot >= 128) as "hero_221",
sum(mp.hero_id = 110 and mp.player_slot >= 128) as "hero_222",
sum(mp.hero_id = 111 and mp.player_slot >= 128) as "hero_223",
sum(mp.hero_id = 112 and mp.player_slot >= 128) as "hero_224"

FROM match m
LEFT JOIN match_player mp
ON m.match_id = mp.match_id
LEFT JOIN hero_characteristics hc
ON hc.hero_id = mp.hero_id
GROUP BY m.match_id
LIMIT 100000;
